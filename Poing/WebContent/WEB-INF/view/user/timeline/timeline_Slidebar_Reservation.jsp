<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<div id="reservation_calendar" class="sidebar">
	<div class="title">예약 캘린더</div>
	<div class="calendar hasDatepicker" id="dp1559529416128">
		<div
			class="ui-datepicker-inline ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"
			style="display: block;">
			<div
				class="ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all">
				<a class="ui-datepicker-prev ui-corner-all" data-handler="prev"
					data-event="click" title="Prev"><span
					class="ui-icon ui-icon-circle-triangle-w">Prev</span></a><a
					class="ui-datepicker-next ui-corner-all" data-handler="next"
					data-event="click" title="Next"><span
					class="ui-icon ui-icon-circle-triangle-e">Next</span></a>
				<div class="ui-datepicker-title">
					<span class="ui-datepicker-month">9월</span>&nbsp;<span
						class="ui-datepicker-year">2019</span>
				</div>
			</div>
			<table class="ui-datepicker-calendar">
				<thead>
					<tr>
						<th class="ui-datepicker-week-end"><span title="Sunday">일</span></th>
						<th><span title="Monday">월</span></th>
						<th><span title="Tuesday">화</span></th>
						<th><span title="Wednesday">수</span></th>
						<th><span title="Thursday">목</span></th>
						<th><span title="Friday">금</span></th>
						<th class="ui-datepicker-week-end"><span title="Saturday">토</span></th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class=" ui-datepicker-week-end date-sunday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">1</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">2</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">3</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">4</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">5</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">6</a></td>
						<td class=" ui-datepicker-week-end date-saturday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">7</a></td>
					</tr>
					<tr>
						<td class=" ui-datepicker-week-end date-sunday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">8</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">9</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">10</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">11</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">12</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">13</a></td>
						<td class=" ui-datepicker-week-end date-saturday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">14</a></td>
					</tr>
					<tr>
						<td class=" ui-datepicker-week-end date-sunday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">15</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">16</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">17</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">18</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">19</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">20</a></td>
						<td class=" ui-datepicker-week-end date-saturday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">21</a></td>
					</tr>
					<tr>
						<td class=" ui-datepicker-week-end date-sunday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">22</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">23</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">24</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">25</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">26</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">27</a></td>
						<td class=" ui-datepicker-week-end date-saturday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">28</a></td>
					</tr>
					<tr>
						<td class=" ui-datepicker-week-end date-sunday"
							data-handler="selectDay" data-event="click" data-month="8"
							data-year="2019"><a class="ui-state-default" href="#">29</a></td>
						<td class=" " data-handler="selectDay" data-event="click"
							data-month="8" data-year="2019"><a class="ui-state-default"
							href="#">30</a></td>
						<td
							class=" ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled "><span
							class="ui-state-default">1</span></td>
						<td
							class=" ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled "><span
							class="ui-state-default">2</span></td>
						<td
							class=" ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled "><span
							class="ui-state-default">3</span></td>
						<td
							class=" ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled "><span
							class="ui-state-default">4</span></td>
						<td
							class=" ui-datepicker-week-end ui-datepicker-other-month ui-datepicker-unselectable ui-state-disabled date-saturday"><span
							class="ui-state-default">5</span></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="desc">
		<span class="recent"></span> <span class="text margin">방문 예정</span> <span
			class="past"></span> <span class="text">지나간 예약</span> <span
			class="coupon"></span> <span class="text">티켓 사용</span>
	</div>
</div>

<script>
$(document).ready(function(){
	$("#content.mypage>.body>.list").on("click", ".reservation>.info>.log>.i_wrap", function(e) {
        if($(this).hasClass("flipped")) {
			$(this).removeClass("flipped");
			$(this).next().children("li:not(:first)").hide();
		} else {
			$(this).addClass("flipped");
			$(this).next().children().show();
		}
	});
	// 티켓 예약 변경
	$("#content.mypage>.body>.list").on("click", ".reservation>button.coupon", function(){
	    $.popup("reserve_coupon", $(this).data());
	});

    // 예약 더 불러오기
    $(".more.reservation").click(function() {

        var page = $(this).data('page');
        var type = 'current';

        $.ajax({
            url: '/user/LoadReservations',
            type: 'GET',
            data: {type: type, page: page+1},
            success: $.proxy(function(res) {
                res = $.parseJSON(res);

                var page = $(this).data('page');
                $(this).data('page', page + 1);
                var el = new EJS({url: '/template/Reservation.ejs'}).render({
                    reservations: res.data.reservations,
                    user_id: '1520484',
                    type: 'current'
                });
                
                $(el).insertBefore(this);
                if(res.meta.page * res.meta.per_page >= res.meta.total)
                    $(this).remove();
            }, this)
        });
    });
});
</script>
